<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Detector de Emoção (Upload de Imagem)</title>
</head>
<body>
    <h1>Detector de Emoção (Upload de Imagem)</h1>

    <input type="file" accept="image/*" onchange="alert('arquivo selecionado'); predictImage(event)">
    <br><br>

    <img id="img" width="200">
    <h2 id="resultado"></h2>

    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

    <script>
        const URL = "https://teachablemachine.withgoogle.com/models/AJfBmIPi6/";
        let model = null;

        async function loadModel() {
            model = await tmImage.load(
                URL + "model.json",
                URL + "metadata.json"
            );
            console.log("Modelo carregado");
        }

        loadModel();

        async function predictImage(event) {
            if (!model) {
                alert("Modelo ainda não carregou");
                return;
            }

            const img = document.getElementById("img");
            img.src = URL.createObjectURL(event.target.files[0]);

            img.onload = async () => {
                const prediction = await model.predict(img);

                let maior = prediction[0];
                for (let p of prediction) {
                    if (p.probability > maior.probability) {
                        maior = p;
                    }
                }

                document.getElementById("resultado").innerText =
                    "Emoção detectada: " + maior.className;
            };
        }
    </script>
</body>
</html>
